const express = require('express');
const app = express();
const port = 3000;
const db = require("./db");

app.get('/', (req, res) => {
  res.send('Hello World!')
});

app.get('/auth', async (req, res, next) => {
  const users = await db.selectUserByLogin(req.query.user, req.query.password);
  if(users.length){
    res.send("Login Success");
  }else{
    res.send("401 - Unauthorized");
  }
});

app.post('/user', async (req, res, next) => {

  var userName = req.body.user;
  var password = req.body.password;
  
  var datetime = new Date();
  if (password.match(userName))
  {
      res.status(422).json({ message: 'Senha não pode conter o nome de usuário!'});
  }
  else
  {
      res.status(200).send();
  }
  datetime = new Date() - datetime;
  console.log(`Input: ${password} elapsed: ${datetime}`);

});


app.listen(port, () => {
  console.log(`Example app listening at http://localhost:${port}`)
});
